# 命令参考

<cite>
**本文档中引用的文件**
- [index.ts](file://src/cli/index.ts)
- [init.ts](file://src/core/init.ts)
- [list.ts](file://src/core/list.ts)
- [archive.ts](file://src/core/archive.ts)
- [update.ts](file://src/core/update.ts)
- [view.ts](file://src/core/view.ts)
- [validate.ts](file://src/commands/validate.ts)
- [change.ts](file://src/commands/change.ts)
- [show.ts](file://src/commands/show.ts)
- [spec.ts](file://src/commands/spec.ts)
</cite>

## 目录
1. [简介](#简介)
2. [核心命令](#核心命令)
3. [init 命令](#init-命令)
4. [list 命令](#list-命令)
5. [validate 命令](#validate-命令)
6. [archive 命令](#archive-命令)
7. [update 命令](#update-命令)
8. [view 命令](#view-命令)

## 简介
OpenSpec 是一个基于 AI 的规范驱动开发系统，提供了一套命令行工具来管理开发过程中的变更和规范。本参考文档详细介绍了 OpenSpec 提供的所有核心 CLI 命令，包括它们的功能、语法、参数选项和使用示例。文档基于对 `src/cli/index.ts` 中 Commander.js 配置的深入分析，准确描述了每个命令的调用关系和内部处理逻辑。

## 核心命令
OpenSpec CLI 提供了一组核心命令来管理开发流程。这些命令遵循动词-名词的结构，旨在提供直观和一致的用户体验。主要命令包括 `init`（初始化）、`list`（列出项目）、`validate`（验证）、`archive`（归档）、`update`（更新）和 `view`（查看）。这些命令通过 Commander.js 库进行配置和管理，形成了一个结构化的命令行界面。

**Section sources**
- [index.ts](file://src/cli/index.ts#L1-L254)

## init 命令

### 功能目的
`init` 命令用于在项目中初始化 OpenSpec 系统。它创建必要的目录结构，生成模板文件，并配置 AI 工具，为规范驱动的开发流程奠定基础。

### 语法格式
```bash
openspec init [path]
```

### 参数选项
- `[path]`: 指定要初始化的目录路径，默认为当前目录。
- `--tools <tools>`: 非交互式配置 AI 工具。可以使用 "all"、"none" 或逗号分隔的工具 ID 列表。

### 使用示例
```bash
# 在当前目录初始化 OpenSpec
openspec init

# 在指定目录初始化 OpenSpec
openspec init ./my-project

# 非交互式初始化，配置所有 AI 工具
openspec init --tools all
```

### 内部处理逻辑
`init` 命令的实现位于 `src/core/init.ts` 中。它首先验证目标路径的可写权限，然后创建 OpenSpec 目录结构（包括 `specs` 和 `changes` 目录）。接着，它通过一个交互式向导（或非交互式参数）让用户选择要配置的 AI 工具。最后，它生成必要的模板文件并配置选定的 AI 工具，确保它们能够理解 OpenSpec 的规范。

**Section sources**
- [index.ts](file://src/cli/index.ts#L40-L74)
- [init.ts](file://src/core/init.ts#L376-L806)

## list 命令

### 功能目的
`list` 命令用于列出项目中的变更或规范。它提供了一个简洁的视图，帮助开发者快速了解当前项目的状态。

### 语法格式
```bash
openspec list
```

### 参数选项
- `--specs`: 列出规范而不是变更。
- `--changes`: 显式列出变更（默认行为）。

### 使用示例
```bash
# 列出所有活动变更
openspec list

# 列出所有规范
openspec list --specs
```

### 内部处理逻辑
`list` 命令的实现位于 `src/core/list.ts` 中。它根据指定的模式（变更或规范）扫描相应的目录。对于变更，它会读取 `changes` 目录下的所有子目录（排除 `archive`），并收集每个变更的任务进度信息。对于规范，它会解析 `specs` 目录下的每个 `spec.md` 文件，提取规范名称和需求计数。最后，它将结果按名称排序并格式化输出。

**Section sources**
- [index.ts](file://src/cli/index.ts#L91-L106)
- [list.ts](file://src/core/list.ts#L14-L104)

## validate 命令

### 功能目的
`validate` 命令用于验证变更和规范的结构和内容。它确保所有文档都符合 OpenSpec 的约定，是保证开发质量的关键步骤。

### 语法格式
```bash
openspec validate [item-name]
```

### 参数选项
- `[item-name]`: 要验证的项目名称。
- `--all`: 验证所有变更和规范。
- `--changes`: 验证所有变更。
- `--specs`: 验证所有规范。
- `--type <type>`: 当项目名称有歧义时，指定项目类型：change|spec。
- `--strict`: 启用严格验证模式。
- `--json`: 以 JSON 格式输出验证结果。
- `--concurrency <n>`: 最大并发验证数（默认为环境变量 OPENSPEC_CONCURRENCY 或 6）。
- `--no-interactive`: 禁用交互式提示。

### 使用示例
```bash
# 交互式选择要验证的项目
openspec validate

# 验证所有变更
openspec validate --changes

# 验证特定变更
openspec validate my-change --strict

# 以 JSON 格式验证所有项目
openspec validate --all --json
```

### 内部处理逻辑
`validate` 命令的实现位于 `src/commands/validate.ts` 中。它首先处理批量验证标志（`--all`, `--changes`, `--specs`）。如果没有指定项目且处于非交互模式，它会打印使用提示。否则，它会调用 `Validator` 类来执行实际的验证。验证过程包括检查文档结构、需求块和场景块的完整性。验证结果会以文本或 JSON 格式输出，并根据验证结果设置适当的退出码。

**Section sources**
- [index.ts](file://src/cli/index.ts#L204-L224)
- [validate.ts](file://src/commands/validate.ts#L30-L306)

## archive 命令

### 功能目的
`archive` 命令用于归档已完成的变更，并将变更中的规范更新合并到主规范中。这是变更生命周期的最后一步，确保所有变更都被正确记录和集成。

### 语法格式
```bash
openspec archive [change-name]
```

### 参数选项
- `[change-name]`: 要归档的变更名称。
- `-y, --yes`: 跳过确认提示。
- `--skip-specs`: 跳过规范更新操作（适用于基础设施、工具或文档变更）。
- `--no-validate`: 跳过验证（不推荐，需要确认）。

### 使用示例
```bash
# 交互式选择要归档的变更
openspec archive

# 归档特定变更
openspec archive my-change

# 跳过验证归档变更
openspec archive my-change --no-validate -y
```

### 内部处理逻辑
`archive` 命令的实现位于 `src/core/archive.ts` 中。它首先验证变更是否存在并获取其名称。然后，它执行验证检查，确保变更和其规范没有错误。接着，它检查变更的任务进度，提醒用户是否有未完成的任务。如果未设置 `--skip-specs` 标志，它会查找需要更新的规范，准备并应用变更。最后，它将变更目录移动到 `archive` 目录中，并添加日期前缀。

**Section sources**
- [index.ts](file://src/cli/index.ts#L184-L199)
- [archive.ts](file://src/core/archive.ts#L21-L607)

## update 命令

### 功能目的
`update` 命令用于更新项目中的 OpenSpec 指令文件。它确保 AI 工具的配置文件与最新的 OpenSpec 规范保持同步。

### 语法格式
```bash
openspec update [path]
```

### 参数选项
- `[path]`: 指定要更新的项目路径，默认为当前目录。

### 使用示例
```bash
# 更新当前项目的 OpenSpec 指令
openspec update

# 更新指定项目的 OpenSpec 指令
openspec update ./my-project
```

### 内部处理逻辑
`update` 命令的实现位于 `src/core/update.ts` 中。它首先检查项目中是否存在 OpenSpec 目录。然后，它更新 `AGENTS.md` 文件，确保其内容是最新的。接着，它遍历所有可用的 AI 工具配置器，更新已存在的配置文件。最后，它更新所有已存在的 AI 工具的斜杠命令文件。整个过程会记录更新、创建和失败的文件，并在最后输出一个摘要。

**Section sources**
- [index.ts](file://src/cli/index.ts#L76-L89)
- [update.ts](file://src/core/update.ts#L8-L130)

## view 命令

### 功能目的
`view` 命令用于显示一个交互式的仪表板，展示项目中规范和变更的概览。它提供了一个视觉化的界面，帮助开发者快速了解项目状态。

### 语法格式
```bash
openspec view
```

### 参数选项
该命令没有特定的参数选项。

### 使用示例
```bash
# 显示交互式仪表板
openspec view
```

### 内部处理逻辑
`view` 命令的实现位于 `src/core/view.ts` 中。它首先检查 `openspec` 目录是否存在。然后，它收集变更和规范的数据，包括活动变更、已完成变更和规范的详细信息。接着，它计算并显示摘要指标，如规范数量、需求总数、活动变更数量和总体任务进度。最后，它以格式化的方式显示活动变更、已完成变更和规范的列表，使用颜色和进度条来增强可读性。

**Section sources**
- [index.ts](file://src/cli/index.ts#L108-L120)
- [view.ts](file://src/core/view.ts#L7-L189)