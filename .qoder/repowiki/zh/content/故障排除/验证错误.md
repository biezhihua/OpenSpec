# éªŒè¯é”™è¯¯æ•…éšœæ’é™¤æŒ‡å—

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [validation.test.ts](file://test/core/validation.test.ts)
- [validate.ts](file://src/commands/validate.ts)
- [validator.ts](file://src/core/validation/validator.ts)
- [types.ts](file://src/core/validation/types.ts)
- [constants.ts](file://src/core/validation/constants.ts)
- [markdown-parser.ts](file://src/core/parsers/markdown-parser.ts)
- [change-parser.ts](file://src/core/parsers/change-parser.ts)
- [cli-validate/spec.md](file://openspec/specs/cli-validate/spec.md)
- [openspec-conventions/spec.md](file://openspec/specs/openspec-conventions/spec.md)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [éªŒè¯ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#éªŒè¯ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
3. [å¸¸è§éªŒè¯é”™è¯¯ç±»å‹](#å¸¸è§éªŒè¯é”™è¯¯ç±»å‹)
4. [ä¸¥æ ¼æ¨¡å¼ä¸è­¦å‘Šå¤„ç†](#ä¸¥æ ¼æ¨¡å¼ä¸è­¦å‘Šå¤„ç†)
5. [éªŒè¯æŠ¥å‘Šè§£è¯»](#éªŒè¯æŠ¥å‘Šè§£è¯»)
6. [è°ƒè¯•æŠ€å·§ä¸å·¥å…·](#è°ƒè¯•æŠ€å·§ä¸å·¥å…·)
7. [åˆ†æ­¥è§£å†³æ–¹æ¡ˆ](#åˆ†æ­¥è§£å†³æ–¹æ¡ˆ)
8. [æœ€ä½³å®è·µå»ºè®®](#æœ€ä½³å®è·µå»ºè®®)

## ç®€ä»‹

OpenSpecéªŒè¯ç³»ç»Ÿæ˜¯ä¸€ä¸ªå…¨é¢çš„è§„èŒƒéªŒè¯æ¡†æ¶ï¼Œç”¨äºç¡®ä¿å˜æ›´ææ¡ˆå’Œè§„æ ¼æ–‡æ¡£ç¬¦åˆOpenSpecçº¦å®šæ ¼å¼ã€‚å½“æ‰§è¡Œ`openspec validate`å‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šå¯¹æŒ‡å®šçš„å˜æ›´æˆ–è§„æ ¼è¿›è¡Œå¤šå±‚æ¬¡çš„éªŒè¯æ£€æŸ¥ï¼ŒåŒ…æ‹¬è¯­æ³•æ­£ç¡®æ€§ã€ç»“æ„å®Œæ•´æ€§ã€å†…å®¹è§„èŒƒæ€§å’Œä¸€è‡´æ€§è¦æ±‚ã€‚

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨è¯Šæ–­å’Œè§£å†³éªŒè¯è¿‡ç¨‹ä¸­é‡åˆ°çš„å„ç§é”™è¯¯ï¼Œæä¾›è¯¦ç»†çš„ç—‡çŠ¶æè¿°ã€æ ¹æœ¬åŸå› åˆ†æå’Œåˆ†æ­¥è§£å†³æ–¹æ³•ã€‚

## éªŒè¯ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

OpenSpecéªŒè¯ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼ŒåŒ…å«å¤šä¸ªéªŒè¯ç»„ä»¶ååŒå·¥ä½œï¼š

```mermaid
graph TB
subgraph "å‘½ä»¤å±‚"
A[ValidateCommand] --> B[å‚æ•°è§£æ]
B --> C[é¡¹ç›®å‘ç°]
end
subgraph "éªŒè¯å™¨å±‚"
D[Validator] --> E[SpecéªŒè¯]
D --> F[ChangeéªŒè¯]
D --> G[DeltaéªŒè¯]
end
subgraph "è§£æå™¨å±‚"
H[MarkdownParser] --> I[ç« èŠ‚è§£æ]
J[ChangeParser] --> K[å˜æ›´è§£æ]
L[RequirementBlocks] --> M[éœ€æ±‚å—è§£æ]
end
subgraph "æ¨¡å¼å±‚"
N[SpecSchema] --> O[ZodéªŒè¯]
P[ChangeSchema] --> O
Q[RequirementSchema] --> O
end
A --> D
E --> H
F --> J
G --> L
H --> N
J --> P
L --> Q
```

**å›¾è¡¨æ¥æº**
- [validate.ts](file://src/commands/validate.ts#L30-L147)
- [validator.ts](file://src/core/validation/validator.ts#L15-L449)

**èŠ‚æ¥æº**
- [validate.ts](file://src/commands/validate.ts#L1-L306)
- [validator.ts](file://src/core/validation/validator.ts#L1-L449)

## å¸¸è§éªŒè¯é”™è¯¯ç±»å‹

### è§„èŒƒæ–‡ä»¶é”™è¯¯

#### ç¼ºå°‘æ¦‚è¿°éƒ¨åˆ†
**ç—‡çŠ¶**: éªŒè¯å¤±è´¥ï¼Œæç¤º"Specå¿…é¡»æœ‰Purposeéƒ¨åˆ†"

**æ ¹æœ¬åŸå› **: è§„èŒƒæ–‡ä»¶ç¼ºå°‘å¿…éœ€çš„`## Purpose`ç« èŠ‚

**è§£å†³æ–¹æ³•**:
1. æ‰“å¼€è§„èŒƒæ–‡ä»¶ï¼ˆ`openspec/specs/[capability]/spec.md`ï¼‰
2. æ·»åŠ `## Purpose`ç« èŠ‚
3. è¾“å…¥è‡³å°‘50å­—ç¬¦çš„é¡¹ç›®æ¦‚è¿°

**ç¤ºä¾‹ä¿®å¤**:
```markdown
## Purpose
ç”¨æˆ·è®¤è¯ç³»ç»Ÿæä¾›å®‰å…¨çš„ç™»å½•å’Œä¼šè¯ç®¡ç†åŠŸèƒ½ï¼Œç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·å¯ä»¥è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚
```

#### ç¼ºå°‘éœ€æ±‚éƒ¨åˆ†
**ç—‡çŠ¶**: éªŒè¯å¤±è´¥ï¼Œæç¤º"Specå¿…é¡»æœ‰Requirementséƒ¨åˆ†"

**æ ¹æœ¬åŸå› **: è§„èŒƒæ–‡ä»¶ç¼ºå°‘`## Requirements`ç« èŠ‚

**è§£å†³æ–¹æ³•**:
1. ç¡®ä¿è§„èŒƒåŒ…å«`## Requirements`æ ‡é¢˜
2. åœ¨è¯¥ç« èŠ‚ä¸‹æ·»åŠ è‡³å°‘ä¸€ä¸ªéœ€æ±‚
3. æ¯ä¸ªéœ€æ±‚å¿…é¡»åŒ…å«`### Requirement:`æ ‡é¢˜å’Œè‡³å°‘ä¸€ä¸ªåœºæ™¯

#### éœ€æ±‚æ–‡æœ¬ç¼ºå°‘SHALL/MUSTå…³é”®å­—
**ç—‡çŠ¶**: éªŒè¯å¤±è´¥ï¼Œæç¤º"Requirementå¿…é¡»åŒ…å«SHALLæˆ–MUSTå…³é”®å­—"

**æ ¹æœ¬åŸå› **: éœ€æ±‚æè¿°ä¸­ç¼ºå°‘å¼ºåˆ¶æ€§å…³é”®å­—

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥æ‰€æœ‰éœ€æ±‚æè¿°
2. ç¡®ä¿æ¯ä¸ªéœ€æ±‚åŒ…å«"SHALL"æˆ–"MUST"å…³é”®å­—
3. å…³é”®å­—åº”ä½äºéœ€æ±‚æè¿°çš„å¼€å§‹ä½ç½®

**ç¤ºä¾‹ä¿®å¤**:
```markdown
### Requirement: ç”¨æˆ·è®¤è¯
ç³»ç»Ÿ SHALL æä¾›åŸºäºJWTçš„å®‰å…¨è®¤è¯æœºåˆ¶ã€‚
```

#### éœ€æ±‚ç¼ºå°‘åœºæ™¯
**ç—‡çŠ¶**: éªŒè¯å¤±è´¥ï¼Œæç¤º"Requirementå¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªåœºæ™¯"

**æ ¹æœ¬åŸå› **: éœ€æ±‚å®šä¹‰ä¸å®Œæ•´ï¼Œç¼ºå°‘è¡Œä¸ºæè¿°

**è§£å†³æ–¹æ³•**:
1. ä¸ºæ¯ä¸ªéœ€æ±‚æ·»åŠ è‡³å°‘ä¸€ä¸ª`#### Scenario:`å—
2. ä½¿ç”¨æ ‡å‡†çš„WHEN/THENæ ¼å¼æè¿°è¡Œä¸º
3. åŒ…å«å¿…è¦çš„å‰ç½®æ¡ä»¶å’Œé¢„æœŸç»“æœ

**ç¤ºä¾‹ä¿®å¤**:
```markdown
#### Scenario: æˆåŠŸç™»å½•
- **WHEN** ç”¨æˆ·æäº¤æœ‰æ•ˆå‡­æ®
- **THEN** ç³»ç»Ÿè¿”å›JWTä»¤ç‰Œ
- **AND** ç”¨æˆ·è¢«é‡å®šå‘åˆ°ä»ªè¡¨æ¿
```

### å˜æ›´ææ¡ˆé”™è¯¯

#### ç¼ºå°‘Whyéƒ¨åˆ†
**ç—‡çŠ¶**: éªŒè¯å¤±è´¥ï¼Œæç¤º"Changeå¿…é¡»æœ‰Whyéƒ¨åˆ†"

**æ ¹æœ¬åŸå› **: å˜æ›´ææ¡ˆç¼ºå°‘å˜æ›´åŠ¨æœºè¯´æ˜

**è§£å†³æ–¹æ³•**:
1. æ‰“å¼€å˜æ›´ææ¡ˆæ–‡ä»¶ï¼ˆ`openspec/changes/[change-id]/proposal.md`ï¼‰
2. æ·»åŠ `## Why`ç« èŠ‚
3. è¾“å…¥è‡³å°‘50å­—ç¬¦çš„å˜æ›´ç†ç”±

**ç¤ºä¾‹ä¿®å¤**:
```markdown
## Why
å½“å‰ç³»ç»Ÿç¼ºä¹ç”¨æˆ·è§’è‰²ç®¡ç†åŠŸèƒ½ï¼Œå¯¼è‡´æ— æ³•æ ¹æ®ç”¨æˆ·æƒé™æ§åˆ¶è®¿é—®ã€‚å®æ–½è§’è‰²ç®¡ç†å°†æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œå¯ç®¡ç†æ€§ã€‚
```

#### Whyéƒ¨åˆ†è¿‡çŸ­
**ç—‡çŠ¶**: éªŒè¯å¤±è´¥ï¼Œæç¤º"Whyéƒ¨åˆ†å¿…é¡»è‡³å°‘50ä¸ªå­—ç¬¦"

**æ ¹æœ¬åŸå› **: Whyéƒ¨åˆ†å†…å®¹è¿‡äºç®€çŸ­ï¼Œæ— æ³•å……åˆ†è¯´æ˜å˜æ›´åŠ¨æœº

**è§£å†³æ–¹æ³•**:
1. æ‰©å±•Whyéƒ¨åˆ†çš„å†…å®¹
2. è¯´æ˜å˜æ›´çš„å…·ä½“åŸå› å’Œä¸šåŠ¡ä»·å€¼
3. æè¿°ç°æœ‰é—®é¢˜å’Œæ”¹è¿›ç›®æ ‡

#### ç¼ºå°‘What Changeséƒ¨åˆ†
**ç—‡çŠ¶**: éªŒè¯å¤±è´¥ï¼Œæç¤º"Changeå¿…é¡»æœ‰What Changeséƒ¨åˆ†"

**æ ¹æœ¬åŸå› **: å˜æ›´ææ¡ˆç¼ºå°‘å…·ä½“å˜æ›´æè¿°

**è§£å†³æ–¹æ³•**:
1. æ·»åŠ `## What Changes`ç« èŠ‚
2. æ˜ç¡®åˆ—å‡ºæ‰€æœ‰å˜æ›´å†…å®¹
3. ä½¿ç”¨æ¸…æ™°çš„é¡¹ç›®ç¬¦å·æ ¼å¼

### Deltaæ–‡ä»¶é”™è¯¯

#### Deltaæ–‡ä»¶ä¸­éœ€æ±‚æ–‡æœ¬ç¼ºå°‘SHALL/MUST
**ç—‡çŠ¶**: éªŒè¯å¤±è´¥ï¼Œæç¤º"ADDED/MODIFIEDéœ€æ±‚å¿…é¡»åŒ…å«SHALLæˆ–MUST"

**æ ¹æœ¬åŸå› **: Deltaæ–‡ä»¶ä¸­çš„éœ€æ±‚æè¿°ä¸ç¬¦åˆè§„èŒƒè¦æ±‚

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥`## ADDED Requirements`å’Œ`## MODIFIED Requirements`éƒ¨åˆ†
2. ç¡®ä¿æ¯ä¸ªéœ€æ±‚åŒ…å«å¼ºåˆ¶æ€§å…³é”®å­—
3. éªŒè¯éœ€æ±‚æè¿°çš„å®Œæ•´æ€§

#### Deltaæ–‡ä»¶ç¼ºå°‘å¿…è¦ç« èŠ‚
**ç—‡çŠ¶**: éªŒè¯å¤±è´¥ï¼Œæç¤º"No delta sections found"

**æ ¹æœ¬åŸå› **: Deltaæ–‡ä»¶ç¼ºå°‘æ“ä½œç±»å‹ç« èŠ‚

**è§£å†³æ–¹æ³•**:
1. ç¡®ä¿Deltaæ–‡ä»¶åŒ…å«ä»¥ä¸‹ç« èŠ‚ä¹‹ä¸€ï¼š
   - `## ADDED Requirements`
   - `## MODIFIED Requirements`
   - `## REMOVED Requirements`
   - `## RENAMED Requirements`
2. æ¯ä¸ªç« èŠ‚å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªéœ€æ±‚å—

**èŠ‚æ¥æº**
- [validation.test.ts](file://test/core/validation.test.ts#L1-L490)
- [validator.ts](file://src/core/validation/validator.ts#L113-L271)

## ä¸¥æ ¼æ¨¡å¼ä¸è­¦å‘Šå¤„ç†

### ä¸¥æ ¼æ¨¡å¼æ¦‚è¿°

OpenSpecéªŒè¯ç³»ç»Ÿæ”¯æŒä¸¥æ ¼æ¨¡å¼ï¼ˆstrict modeï¼‰ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè­¦å‘Šä¼šè¢«æå‡ä¸ºé”™è¯¯ï¼Œå½±å“éªŒè¯ç»“æœã€‚

```mermaid
flowchart TD
A[éªŒè¯è¯·æ±‚] --> B{ä¸¥æ ¼æ¨¡å¼?}
B --> |æ˜¯| C[ä¸¥æ ¼éªŒè¯è§„åˆ™]
B --> |å¦| D[å®½æ¾éªŒè¯è§„åˆ™]
C --> E[é”™è¯¯ + è­¦å‘Š = å¤±è´¥]
D --> F[ä»…é”™è¯¯ = å¤±è´¥]
E --> G[é€€å‡ºç  1]
F --> H[è­¦å‘Šä¸å½±å“ç»“æœ]
```

**å›¾è¡¨æ¥æº**
- [validator.ts](file://src/core/validation/validator.ts#L385-L387)

### ä¸¥æ ¼æ¨¡å¼ä¸‹çš„è­¦å‘Šå‡çº§

åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä»¥ä¸‹ç±»å‹çš„è­¦å‘Šä¼šè¢«è§†ä¸ºé”™è¯¯ï¼š

#### æ¦‚è¿°éƒ¨åˆ†è¿‡çŸ­
**ç—‡çŠ¶**: "Purpose section is too brief (less than 50 characters)"

**ä¸¥æ ¼æ¨¡å¼å¤„ç†**: è‡ªåŠ¨å‡çº§ä¸ºé”™è¯¯

**è§£å†³æ–¹æ³•**:
1. æ‰©å±•æ¦‚è¿°éƒ¨åˆ†å†…å®¹
2. æä¾›æ›´è¯¦ç»†çš„é¡¹ç›®æè¿°
3. åŒ…å«é¡¹ç›®çš„ç›®æ ‡å’ŒèŒƒå›´ä¿¡æ¯

#### éœ€æ±‚æ–‡æœ¬è¿‡é•¿
**ç—‡çŠ¶**: "Requirement text is very long (>500 characters)"

**ä¸¥æ ¼æ¨¡å¼å¤„ç†**: å‡çº§ä¸ºé”™è¯¯

**è§£å†³æ–¹æ³•**:
1. å°†é•¿éœ€æ±‚æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„éœ€æ±‚
2. ä¿æŒæ¯ä¸ªéœ€æ±‚çš„ä¸“æ³¨æ€§
3. ç¡®ä¿æ¯ä¸ªéœ€æ±‚éƒ½æœ‰æ˜ç¡®çš„è¾¹ç•Œ

#### åœºæ™¯æ•°é‡ä¸è¶³
**ç—‡çŠ¶**: "Requirement must have at least one scenario"

**ä¸¥æ ¼æ¨¡å¼å¤„ç†**: å‡çº§ä¸ºé”™è¯¯

**è§£å†³æ–¹æ³•**:
1. ä¸ºæ¯ä¸ªéœ€æ±‚æ·»åŠ è‡³å°‘ä¸€ä¸ªåœºæ™¯
2. ä½¿ç”¨æ ‡å‡†æ ¼å¼æè¿°è¡Œä¸º
3. åŒ…å«å®Œæ•´çš„WHEN/THENåºåˆ—

### å¯ç”¨ä¸¥æ ¼æ¨¡å¼

ä½¿ç”¨`--strict`æ ‡å¿—å¯ç”¨ä¸¥æ ¼æ¨¡å¼ï¼š

```bash
# ä¸¥æ ¼æ¨¡å¼éªŒè¯
openspec validate --all --strict

# ä¸¥æ ¼æ¨¡å¼éªŒè¯ç‰¹å®šå˜æ›´
openspec validate my-change --strict
```

**èŠ‚æ¥æº**
- [validator.ts](file://src/core/validation/validator.ts#L291-L316)
- [validate.ts](file://src/commands/validate.ts#L291-L339)

## éªŒè¯æŠ¥å‘Šè§£è¯»

### æŠ¥å‘Šç»“æ„

OpenSpecéªŒè¯è¾“å‡ºåŒ…å«ä»¥ä¸‹å±‚æ¬¡çš„ä¿¡æ¯ï¼š

```mermaid
graph LR
A[éªŒè¯æŠ¥å‘Š] --> B[æ€»ä½“çŠ¶æ€]
A --> C[é—®é¢˜åˆ—è¡¨]
A --> D[æ‘˜è¦ç»Ÿè®¡]
B --> E[valid: true/false]
C --> F[ERRORçº§åˆ«]
C --> G[WARNINGçº§åˆ«]
C --> H[INFOçº§åˆ«]
D --> I[é”™è¯¯è®¡æ•°]
D --> J[è­¦å‘Šè®¡æ•°]
D --> K[ä¿¡æ¯è®¡æ•°]
```

**å›¾è¡¨æ¥æº**
- [types.ts](file://src/core/validation/types.ts#L11-L19)

### é”™è¯¯çº§åˆ«è¯´æ˜

#### ERRORçº§åˆ«
**ç‰¹ç‚¹**: å¯¼è‡´éªŒè¯å¤±è´¥ï¼Œå¿…é¡»ä¿®å¤çš„é—®é¢˜

**å¸¸è§ç±»å‹**:
- ç¼ºå°‘å¿…éœ€çš„ç« èŠ‚
- å†…å®¹æ ¼å¼ä¸æ­£ç¡®
- å…³é”®å­—ç¼ºå¤±
- ç»“æ„å®Œæ•´æ€§é—®é¢˜

**ç¤ºä¾‹**:
```
âœ— [ERROR] openspec/specs/cli-validate/spec.md: Spec must have a Purpose section
```

#### WARNINGçº§åˆ«
**ç‰¹ç‚¹**: æ½œåœ¨é—®é¢˜ï¼Œå¯èƒ½å½±å“è´¨é‡ä½†ä¸å½±å“éªŒè¯é€šè¿‡

**å¸¸è§ç±»å‹**:
- å†…å®¹é•¿åº¦é™åˆ¶
- æ ¼å¼ä¼˜åŒ–å»ºè®®
- æœ€ä½³å®è·µæé†’

**ç¤ºä¾‹**:
```
âš  [WARNING] openspec/specs/cli-validate/spec.md: Purpose section is too brief (less than 50 characters)
```

#### INFOçº§åˆ«
**ç‰¹ç‚¹**: ä¿¡æ¯æ€§æ¶ˆæ¯ï¼Œæä¾›é¢å¤–ä¸Šä¸‹æ–‡

**å¸¸è§ç±»å‹**:
- æ€§èƒ½æç¤º
- å…¼å®¹æ€§ä¿¡æ¯
- ç»Ÿè®¡æ•°æ®

**ç¤ºä¾‹**:
```
â„¹ [INFO] openspec/specs/cli-validate/spec.md: Requirement text is very long (>500 characters)
```

### è§£è¯»éªŒè¯è¾“å‡º

#### å•ä¸ªé¡¹ç›®éªŒè¯
```
Change 'add-user-auth' has issues
âœ— [ERROR] openspec/changes/add-user-auth/proposal.md: Change must have a Why section
âœ— [ERROR] openspec/changes/add-user-auth/proposal.md: Change must have a What Changes section
Next steps:
- Ensure change has deltas in specs/: use headers ## ADDED/MODIFIED/REMOVED/RENAMED Requirements
- Each requirement MUST include at least one #### Scenario: block
- Debug parsed deltas: openspec change show <id> --json --deltas-only
```

#### æ‰¹é‡éªŒè¯
```
âœ“ change/add-user-auth
âœ— change/improve-validate-error-messages
âœ“ spec/cli-validate
âœ“ spec/openspec-conventions
Totals: 3 passed, 1 failed (4 items)
```

**èŠ‚æ¥æº**
- [types.ts](file://src/core/validation/types.ts#L1-L19)
- [validate.ts](file://src/commands/validate.ts#L149-L180)

## è°ƒè¯•æŠ€å·§ä¸å·¥å…·

### è¯¦ç»†æ—¥å¿—æ¨¡å¼

ä½¿ç”¨`--json`æ ‡å¿—è·å–ç»“æ„åŒ–è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•ï¼š

```bash
# è·å–JSONæ ¼å¼çš„éªŒè¯æŠ¥å‘Š
openspec validate my-change --json

# æ‰¹é‡éªŒè¯å¹¶è·å–JSONè¾“å‡º
openspec validate --all --json
```

**JSONè¾“å‡ºç¤ºä¾‹**:
```json
{
  "items": [
    {
      "id": "my-change",
      "type": "change",
      "valid": false,
      "issues": [
        {
          "level": "ERROR",
          "path": "why",
          "message": "Change must have a Why section"
        }
      ],
      "durationMs": 123
    }
  ],
  "summary": {
    "totals": { "items": 1, "passed": 0, "failed": 1 },
    "byType": { "change": { "items": 1, "passed": 0, "failed": 1 } }
  },
  "version": "1.0"
}
```

### è°ƒè¯•ç‰¹å®šåŠŸèƒ½

#### æŸ¥çœ‹è§£æçš„Delta
```bash
# æŸ¥çœ‹å˜æ›´çš„è§£æç»“æœ
openspec change show my-change --json --deltas-only
```

#### éªŒè¯ç‰¹å®šéƒ¨åˆ†
```bash
# éªŒè¯å•ä¸ªè§„æ ¼
openspec validate spec-name

# éªŒè¯å•ä¸ªå˜æ›´
openspec validate change-name
```

#### äº¤äº’å¼éªŒè¯
```bash
# äº¤äº’å¼é€‰æ‹©è¦éªŒè¯çš„å†…å®¹
openspec validate
```

### å¸¸ç”¨è°ƒè¯•å‘½ä»¤

```bash
# éªŒè¯æ‰€æœ‰å†…å®¹
openspec validate --all

# ä»…éªŒè¯å˜æ›´
openspec validate --changes

# ä»…éªŒè¯è§„æ ¼
openspec validate --specs

# ä¸¥æ ¼æ¨¡å¼éªŒè¯
openspec validate --all --strict

# JSONæ ¼å¼è¾“å‡º
openspec validate --all --json
```

### æ—¥å¿—åˆ†ææŠ€å·§

#### è¿‡æ»¤ç‰¹å®šçº§åˆ«çš„é—®é¢˜
```bash
# åªæ˜¾ç¤ºé”™è¯¯
openspec validate --all --json | jq '.items[].issues[] | select(.level == "ERROR")'

# åªæ˜¾ç¤ºè­¦å‘Š
openspec validate --all --json | jq '.items[].issues[] | select(.level == "WARNING")'
```

#### æŒ‰ç±»å‹è¿‡æ»¤
```bash
# åªæ˜¾ç¤ºå˜æ›´é—®é¢˜
openspec validate --all --json | jq '.items[] | select(.type == "change")'

# åªæ˜¾ç¤ºè§„æ ¼é—®é¢˜
openspec validate --all --json | jq '.items[] | select(.type == "spec")'
```

**èŠ‚æ¥æº**
- [validate.ts](file://src/commands/validate.ts#L149-L180)
- [validate.ts](file://src/commands/validate.ts#L283-L305)

## åˆ†æ­¥è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤1ï¼šè¯†åˆ«é—®é¢˜ç±»å‹

#### ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥éªŒè¯è¾“å‡º
```
Change 'add-user-auth' has issues
âœ— [ERROR] openspec/changes/add-user-auth/proposal.md: Change must have a Why section
âœ— [ERROR] openspec/changes/add-user-auth/proposal.md: Change must have a What Changes section
```

#### ç¬¬äºŒæ­¥ï¼šç¡®å®šé—®é¢˜ä¸¥é‡ç¨‹åº¦
- **ERROR**: å¿…é¡»ç«‹å³ä¿®å¤
- **WARNING**: å»ºè®®ä¿®å¤
- **INFO**: å¯é€‰ä¼˜åŒ–

### æ­¥éª¤2ï¼šå®šä½å…·ä½“é—®é¢˜

#### ä½¿ç”¨è·¯å¾„ä¿¡æ¯
```
[ERROR] openspec/changes/add-user-auth/proposal.md: Change must have a Why section
```
- æ–‡ä»¶è·¯å¾„ï¼š`openspec/changes/add-user-auth/proposal.md`
- é—®é¢˜æè¿°ï¼šç¼ºå°‘Whyéƒ¨åˆ†

#### ä½¿ç”¨JSONè¾“å‡ºç²¾ç¡®å®šä½
```bash
openspec validate add-user-auth --json | jq '.items[].issues[]'
```

### æ­¥éª¤3ï¼šåº”ç”¨å…·ä½“è§£å†³æ–¹æ¡ˆ

#### è§£å†³ç¼ºå°‘ç« èŠ‚çš„é—®é¢˜
1. **æ‰“å¼€æ–‡ä»¶**ï¼š`nano openspec/changes/add-user-auth/proposal.md`
2. **æ·»åŠ ç¼ºå¤±ç« èŠ‚**ï¼š
   ```markdown
   ## Why
   æˆ‘ä»¬éœ€è¦å®ç°ç”¨æˆ·è®¤è¯åŠŸèƒ½æ¥ä¿æŠ¤åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§å’Œç”¨æˆ·æ•°æ®ã€‚
   
   ## What Changes
   - **user-auth**: æ·»åŠ æ–°çš„ç”¨æˆ·è®¤è¯è§„èŒƒ
   - **api-endpoints**: ä¿®æ”¹ä»¥åŒ…å«è®¤è¯ç«¯ç‚¹
   ```

#### è§£å†³æ ¼å¼é—®é¢˜
1. **æ£€æŸ¥éœ€æ±‚æ ¼å¼**ï¼š
   ```markdown
   ### Requirement: Secure Authentication
   ç³»ç»Ÿ SHALL æä¾›åŸºäºJWTçš„å®‰å…¨è®¤è¯æœºåˆ¶ã€‚
   ```
2. **æ·»åŠ åœºæ™¯**ï¼š
   ```markdown
   #### Scenario: Successful Login
   - **WHEN** ç”¨æˆ·æäº¤æœ‰æ•ˆå‡­æ®
   - **THEN** ç³»ç»Ÿè¿”å›JWTä»¤ç‰Œ
   ```

### æ­¥éª¤4ï¼šéªŒè¯ä¿®å¤æ•ˆæœ

#### é‡æ–°è¿è¡ŒéªŒè¯
```bash
openspec validate add-user-auth
```

#### æ£€æŸ¥è¾“å‡º
```
Change 'add-user-auth' is valid
```

#### éªŒè¯æ‰€æœ‰å†…å®¹
```bash
openspec validate --all
```

### æ­¥éª¤5ï¼šé¢„é˜²é‡å¤é—®é¢˜

#### ä½¿ç”¨æ¨¡æ¿
å‚è€ƒæ­£ç¡®çš„æ ¼å¼æ¨¡æ¿ï¼š
- [cli-validate/spec.md](file://openspec/specs/cli-validate/spec.md)
- [openspec-conventions/spec.md](file://openspec/specs/openspec-conventions/spec.md)

#### å®æ–½è‡ªåŠ¨åŒ–æ£€æŸ¥
```bash
# åˆ›å»ºéªŒè¯è„šæœ¬
#!/bin/bash
echo "Running OpenSpec validation..."
openspec validate --all --strict
if [ $? -eq 0 ]; then
    echo "âœ… All validations passed!"
else
    echo "âŒ Some validations failed!"
    exit 1
fi
```

**èŠ‚æ¥æº**
- [validate.ts](file://src/commands/validate.ts#L104-L146)
- [validator.ts](file://src/core/validation/validator.ts#L22-L49)

## æœ€ä½³å®è·µå»ºè®®

### å¼€å‘é˜¶æ®µæœ€ä½³å®è·µ

#### è§„èŒƒç¼–å†™
1. **ä½¿ç”¨ç»“æ„åŒ–æ ¼å¼**
   - å§‹ç»ˆåŒ…å«`## Purpose`å’Œ`## Requirements`ç« èŠ‚
   - ä½¿ç”¨æ ‡å‡†çš„`### Requirement:`å’Œ`#### Scenario:`æ ¼å¼
   - ç¡®ä¿æ¯ä¸ªéœ€æ±‚åŒ…å«SHALLæˆ–MUSTå…³é”®å­—

2. **å†…å®¹è´¨é‡**
   - æ¦‚è¿°éƒ¨åˆ†è‡³å°‘50å­—ç¬¦
   - éœ€æ±‚æè¿°æ¸…æ™°å‡†ç¡®
   - åœºæ™¯æè¿°å®Œæ•´å…·ä½“

3. **æ ¼å¼è§„èŒƒ**
   - ä½¿ç”¨ä¸€è‡´çš„æ ‡é¢˜å±‚çº§
   - éµå¾ªWHEN/THENæ ¼å¼
   - ä¿æŒé€‚å½“çš„ç¼©è¿›å’Œç©ºç™½

#### å˜æ›´ææ¡ˆ
1. **Whyéƒ¨åˆ†**
   - è¯´æ˜å˜æ›´åŠ¨æœºå’Œä¸šåŠ¡ä»·å€¼
   - æè¿°ç°æœ‰é—®é¢˜å’Œæ”¹è¿›ç›®æ ‡
   - è‡³å°‘50å­—ç¬¦

2. **What Changeséƒ¨åˆ†**
   - æ˜ç¡®åˆ—å‡ºæ‰€æœ‰å˜æ›´å†…å®¹
   - ä½¿ç”¨æ¸…æ™°çš„é¡¹ç›®ç¬¦å·
   - åŒ…å«æŠ€æœ¯ç»†èŠ‚

3. **Deltaæ ¼å¼**
   - ä½¿ç”¨æ­£ç¡®çš„æ“ä½œç±»å‹ç« èŠ‚
   - ç¡®ä¿æ¯ä¸ªéœ€æ±‚éƒ½æœ‰åœºæ™¯
   - é¿å…é‡å¤çš„å¤´éƒ¨åç§°

### å›¢é˜Ÿåä½œæœ€ä½³å®è·µ

#### å®šæœŸéªŒè¯
```bash
# CI/CDé›†æˆ
openspec validate --all --strict

# é¢„æäº¤é’©å­
#!/bin/sh
openspec validate --changes --strict
```

#### æ–‡æ¡£ç»´æŠ¤
1. **ç‰ˆæœ¬æ§åˆ¶**
   - å°†è§„èŒƒæ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶
   - è®°å½•å˜æ›´å†å²
   - ç»´æŠ¤æ›´æ–°æ—¥å¿—

2. **çŸ¥è¯†å…±äº«**
   - åˆ†äº«æˆåŠŸæ¡ˆä¾‹
   - è®¨è®ºå¸¸è§é—®é¢˜
   - æ›´æ–°å›¢é˜ŸæŒ‡å—

#### è´¨é‡ä¿è¯
1. **åŒè¡Œè¯„å®¡**
   - å®šæœŸå®¡æŸ¥è§„èŒƒè´¨é‡
   - æ£€æŸ¥æ ¼å¼ä¸€è‡´æ€§
   - éªŒè¯å†…å®¹å‡†ç¡®æ€§

2. **è‡ªåŠ¨åŒ–æµ‹è¯•**
   - é›†æˆéªŒè¯åˆ°æ„å»ºæµç¨‹
   - è®¾ç½®è´¨é‡é—¨ç¦
   - ç›‘æ§éªŒè¯ç»“æœè¶‹åŠ¿

### å·¥å…·é“¾é›†æˆ

#### IDEé…ç½®
1. **è¯­æ³•é«˜äº®**
   - é…ç½®Markdownè¯­æ³•é«˜äº®
   - è®¾ç½®è‡ªå®šä¹‰è¯­è¨€æ¨¡å¼

2. **å®æ—¶éªŒè¯**
   - å®‰è£…éªŒè¯æ’ä»¶
   - é…ç½®è‡ªåŠ¨æ£€æŸ¥

#### CI/CDé›†æˆ
```yaml
# GitHub Actionsç¤ºä¾‹
name: OpenSpec Validation
on: [push, pull_request]
jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install OpenSpec
        run: npm install -g @fission-ai/openspec
      - name: Validate specs
        run: openspec validate --all --strict
```

#### è‡ªåŠ¨åŒ–è„šæœ¬
```bash
#!/bin/bash
# æ‰¹é‡éªŒè¯è„šæœ¬
echo "ğŸ” æ­£åœ¨éªŒè¯æ‰€æœ‰OpenSpecè§„èŒƒ..."

# éªŒè¯è§„æ ¼
echo "ğŸ“‹ éªŒè¯è§„æ ¼..."
openspec validate --specs --strict

# éªŒè¯å˜æ›´
echo "ğŸ”„ éªŒè¯å˜æ›´..."
openspec validate --changes --strict

# æ£€æŸ¥ç»“æœ
if [ $? -eq 0 ]; then
    echo "âœ… æ‰€æœ‰éªŒè¯é€šè¿‡ï¼"
else
    echo "âŒ å‘ç°éªŒè¯é—®é¢˜ï¼Œè¯·æ£€æŸ¥è¾“å‡ºã€‚"
    exit 1
fi
```

é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œæ‚¨å¯ä»¥æ˜¾è‘—æé«˜OpenSpecè§„èŒƒçš„è´¨é‡ï¼Œå‡å°‘éªŒè¯é”™è¯¯ï¼Œå¹¶å»ºç«‹å¯æŒç»­çš„æ–‡æ¡£ç»´æŠ¤æµç¨‹ã€‚

**èŠ‚æ¥æº**
- [cli-validate/spec.md](file://openspec/specs/cli-validate/spec.md#L1-L219)
- [openspec-conventions/spec.md](file://openspec/specs/openspec-conventions/spec.md#L1-L474)